# Mosquitto MQTT Broker Configuration
# Production-grade security setup

# ============================================================================
# NETWORK LISTENERS
# ============================================================================

# MQTT over TCP
listener 1883
protocol mqtt

# WebSocket (optional - for web clients if needed)
# listener 9001
# protocol websockets

# ============================================================================
# SECURITY
# ============================================================================

# Disable anonymous access - ALL clients must authenticate
allow_anonymous false

# Password file (managed by Django backend via mosquitto_passwd)
password_file /mosquitto/config/psk.txt

# ACL file (static - never changed at runtime)
acl_file /mosquitto/config/acl.txt

# ============================================================================
# PERSISTENCE
# ============================================================================

# Enable message persistence
persistence true
persistence_location C:\Users\Parakram Singh\Desktop\new-version\psk-django-backend\mosquitto\data\

# ============================================================================
# LOGGING
# ============================================================================

# Log to stdout (Docker/systemd will capture)
log_dest stdout

# Log types
log_type error
log_type warning
log_type notice
log_type information

# Optionally log connections (useful for debugging)
# log_type all

# Optional: Log to file instead
# log_dest file /var/log/mosquitto/mosquitto.log

# ============================================================================
# PERFORMANCE TUNING (Optional)
# ============================================================================

# Maximum connections
max_connections 1000

# Message size limits
message_size_limit 10485760  # 10MB

# Queue limits per client
max_queued_messages 1000

# ============================================================================
# NOTES
# ============================================================================

# 1. passwords.txt is DYNAMIC - managed by Django backend
# 2. acl.txt is STATIC - never changed after initial deployment
# 3. Reload with HUP signal after password changes (systemctl reload mosquitto)
# 4. ACL uses %u pattern for per-device isolation
